<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Folder Selection</title>
  </head>
  <body>
    <h1>Select a Folder</h1>
    <input type="file" id="folderInput" webkitdirectory multiple />
    <button id="submitBtn">Submit</button>

    <script>
      document
        .getElementById("submitBtn")
        .addEventListener("click", function () {
          const folderInput = document.getElementById("folderInput");
          const files = folderInput.files;

          if (files.length > 0) {
            const folderStructure = {};

            // Build the folder structure
            for (const file of files) {
              const pathParts = file.webkitRelativePath.split("/");
              const fileName = pathParts.pop(); // Get the file name
              const folderPath = pathParts.join("/") + "/"; // Rebuild the folder path

              // Create the file object
              const fileObject = {
                filename: fileName,
                size: file.size,
                extension: fileName.split(".").pop(), // Get the file extension
                creation_date: new Date(file.lastModified).toLocaleString(
                  "en-GB",
                  { timeZone: "UTC" }
                ), // Get creation date
                modified_date: new Date(file.lastModified).toLocaleString(
                  "en-GB",
                  { timeZone: "UTC" }
                ), // Get modified date
              };

              // console.log(pathParts);
              // If the folder path doesn't exist, create it
              const parentPath = pathParts.slice(0, -1).join("/") + "/";
             
              if (!folderStructure[folderPath]) {
             
                folderStructure[folderPath] = [];
              }

              // Add the file object to the corresponding folder
              folderStructure[folderPath].push(fileObject);
            }
            console.log(
              "Folder Structure:",
              JSON.stringify(folderStructure, null, 2)
            );
            // Log the folder structure to verify its contents

            // Send the folder structure to the server
            // fetch('/create-folder', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json'
            //     },
            //     body: JSON.stringify(folderStructure)
            // })
            // .then(response => response.json())
            // .then(data => {
            //     console.log('Success:', data);
            //     alert('Folders created successfully!');
            // })
            // .catch((error) => {
            //     console.error('Error:', error);
            //     alert('Error creating folders.');
            // });
          } else {
            alert("Please select a folder.");
          }
        });
    </script>
  </body>
</html>
